var sys  = require('sys');

BruteForce = function() {
	var _this = this;
	var _time = 30;
	var _max_tries = 4;
	var _connections = {};
	
	var _reset = funciton(){
		_connectoins
	};
	
	var _startTimer = function(){
		setTimeout(function(){ 
			console.log('hello'); 
		}, 30000);
		return;
	};

	var _addConnection = function(ip){
		sys.log('Adding ' + ip + ' to connections');
		if (_connections[ip]) {
			_connections[ip]['tries'] += 1;
		} else {
			_connections[ip] = {'tries': 1, 'timestamp': new Date().now()};
		}
		sys.log(_connections[ip]);
	};
	
	this.check = function(ip){
		sys.log('BruteForce check ...');
		
		if (_connections[ip])  {
			tries = _connections[ip]['tries'];
			time  = _connections[ip]['timestamp'];
			now   = new Date().now();
			
			too_much = tries >= _max_tries;
			in_time  = time < _time * 1000 + now; 
			
			if (too_much && in_time){
				sys.log('IP: ' + ip + ' blocked because of too many requests');
				return true;
			} else if(!in_time) {
				_reset(ip);
			} else {
			
			} 
		}
	};
	
	_startTimer();
};
exports.BruteForce = BruteForce;